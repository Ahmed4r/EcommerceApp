name: iOS-ipa-build

on:
  workflow_dispatch:

jobs:
  build-ios:
    name: ğŸ‰ iOS Build
    runs-on: macos-latest

    steps:
      - name: ğŸ›’ Checkout Repository
        uses: actions/checkout@v3

      - name: ğŸ”§ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          architecture: x64

      # âœ… ØªÙ‡ÙŠØ¦Ø© Flutter Ù„Ù„Ù…Ø´Ø±ÙˆØ¹
      - name: ğŸ“¦ Flutter Pub Get
        run: flutter pub get

      # âœ… Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
      - name: ğŸ§¹ Clean Flutter & iOS
        run: |
          flutter clean
          cd ios
          pod deintegrate
          pod cache clean --all
          cd ..

      # âœ… Install iOS dependencies
      - name: ğŸ“¥ Install CocoaPods
        run: |
          cd ios
          pod install
          cd ..

      # âœ… Build IPA
      - name: ğŸ“¦ Build iOS IPA
        run: flutter build ipa --no-codesign

      # âœ… Ø­ÙØ¸ Ù…Ù„Ù IPA Ø§Ù„Ù†Ø§ØªØ¬
      - name: ğŸ“‚ Upload IPA Artifact
        uses: actions/upload-artifact@v4
        with:
          name: app-release-ipa
          path: build/ios/ipa/*.ipa
